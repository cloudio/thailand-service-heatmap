<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoWildFishing - Complete System Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .flow-card {
            background-color: white;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            padding: 1.25rem;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            min-height: 120px;
        }
        .flow-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        .flow-card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        .flow-card .subtitle {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }
        .flow-card .icon {
            margin: 0 auto 0.75rem;
            height: 2.5rem;
            width: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .flow-card .content {
            font-size: 0.875rem;
            color: #475569;
            line-height: 1.4;
        }
        .conversion-point {
            border-color: #f59e0b !important;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }
        .conversion-point::after {
            content: "ðŸŽ¯";
            position: absolute;
            top: -8px;
            right: -8px;
            background: #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .error-state {
            border-color: #ef4444 !important;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        }
        .system-flow {
            border-color: #8b5cf6 !important;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        }
        .guest-flow { color: #059669; background-color: #ecfdf5; }
        .operator-flow { color: #d97706; background-color: #fffbeb; }
        .shared-flow { color: #3b82f6; background-color: #eff6ff; }
        .system-icon { color: #8b5cf6; background-color: #faf5ff; }
        .error-icon { color: #ef4444; background-color: #fef2f2; }
        
        .section-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
        }
        
        .flow-arrow {
            stroke: #64748b;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        .conversion-arrow {
            stroke: #f59e0b;
            stroke-width: 3;
            marker-end: url(#conversion-arrowhead);
        }
        .error-arrow {
            stroke: #ef4444;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            marker-end: url(#error-arrowhead);
        }
        
        .legend {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            font-size: 0.75rem;
            z-index: 1000;
        }
    </style>
</head>
<body class="p-4">

    <!-- Legend -->
    <div class="legend">
        <h4 class="font-semibold mb-2">Legend</h4>
        <div class="space-y-1">
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 bg-yellow-100 border border-yellow-400 rounded"></div>
                <span>ðŸŽ¯ Conversion Point</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 bg-red-100 border border-red-400 rounded"></div>
                <span>Error Handling</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 bg-purple-100 border border-purple-400 rounded"></div>
                <span>System Process</span>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">GoWildFishing - Complete System Architecture</h1>
            <p class="text-gray-600">Full user journey mapping for development, analytics, and conversion optimization</p>
        </div>

        <div id="sitemap-container" class="relative">
            
            <!-- GUEST CONVERSION FUNNEL -->
            <div class="mb-16">
                <div class="section-header">
                    <h2 class="text-2xl font-bold text-green-700">GUEST CONVERSION FUNNEL</h2>
                    <p class="text-sm text-gray-600 mt-1">Primary revenue-generating user journey</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div id="homepage" class="flow-card conversion-point">
                        <div class="icon guest-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
                            </svg>
                        </div>
                        <h3>Homepage</h3>
                        <div class="subtitle">Entry Point</div>
                        <p class="content">Hero section, featured trips, value proposition. Track: page views, scroll depth, CTA clicks</p>
                    </div>

                    <div id="search-browse" class="flow-card conversion-point">
                        <div class="icon guest-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                            </svg>
                        </div>
                        <h3>Search & Browse</h3>
                        <div class="subtitle">Discovery</div>
                        <p class="content">Trip listings, filters (country, species, date, price). Track: search queries, filter usage, results interaction</p>
                    </div>

                    <div id="trip-detail" class="flow-card conversion-point">
                        <div class="icon guest-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            </svg>
                        </div>
                        <h3>Trip Details</h3>
                        <div class="subtitle">Consideration</div>
                        <p class="content">Full itinerary, photos, reviews, AI forecast. Track: time on page, image views, booking button clicks</p>
                    </div>

                    <div id="booking-flow" class="flow-card conversion-point">
                        <div class="icon guest-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                            </svg>
                        </div>
                        <h3>Booking Process</h3>
                        <div class="subtitle">Conversion</div>
                        <p class="content">Date selection, guest info, payment. Track: funnel steps, abandonment points, completion rate</p>
                    </div>
                </div>
            </div>

            <!-- AUTHENTICATION & SYSTEM FLOWS -->
            <div class="mb-16">
                <div class="section-header">
                    <h2 class="text-2xl font-bold text-blue-700">AUTHENTICATION & SHARED SYSTEMS</h2>
                    <p class="text-sm text-gray-600 mt-1">Cross-platform functionality and user management</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
                    <div id="auth-entry" class="flow-card system-flow">
                        <div class="icon shared-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                            </svg>
                        </div>
                        <h3>Login/Register</h3>
                        <div class="subtitle">Gateway</div>
                        <p class="content">Unified auth for guests & operators. Track: registration source, login success rate, user type selection</p>
                    </div>

                    <div id="guest-dashboard" class="flow-card">
                        <div class="icon shared-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                            </svg>
                        </div>
                        <h3>Guest Dashboard</h3>
                        <div class="subtitle">User Hub</div>
                        <p class="content">Bookings, profile, wishlist, messages. Track: feature usage, return visits, support requests</p>
                    </div>

                    <div id="payment-system" class="flow-card system-flow">
                        <div class="icon system-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h6m-3-12.75a1.125 1.125 0 0 1-1.125-1.125H7.5a1.125 1.125 0 0 1-1.125 1.125v.006a1.125 1.125 0 0 1 1.125 1.125v.005a1.125 1.125 0 0 1-1.125 1.125H6.375a1.125 1.125 0 0 1-1.125-1.125v-8.25a1.125 1.125 0 0 1 1.125-1.125h9.25a1.125 1.125 0 0 1 1.125 1.125v8.25a1.125 1.125 0 0 1-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125v-.006a1.125 1.125 0 0 1 1.125-1.125v-.005" />
                            </svg>
                        </div>
                        <h3>Payment Processing</h3>
                        <div class="subtitle">Transaction</div>
                        <p class="content">Stripe/local payment gateway. Track: payment method selection, success/failure rates, refund requests</p>
                    </div>

                    <div id="booking-confirmation" class="flow-card conversion-point">
                        <div class="icon shared-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                            </svg>
                        </div>
                        <h3>Confirmation</h3>
                        <div class="subtitle">Success</div>
                        <p class="content">Booking confirmed, email sent, operator notified. Track: completion rate, email delivery, operator response time</p>
                    </div>

                    <div id="trip-management" class="flow-card">
                        <div class="icon shared-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5a2.25 2.25 0 0 0 2.25-2.25m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5a2.25 2.25 0 0 1 21 9v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
                            </svg>
                        </div>
                        <h3>Trip Management</h3>
                        <div class="subtitle">Operations</div>
                        <p class="content">View bookings, manage calendar, guest communication. Track: operator engagement, response times</p>
                    </div>
                </div>
            </div>

            <!-- OPERATOR BUSINESS FLOW -->
            <div class="mb-16">
                <div class="section-header">
                    <h2 class="text-2xl font-bold text-orange-700">OPERATOR BUSINESS MANAGEMENT</h2>
                    <p class="text-sm text-gray-600 mt-1">Revenue management and business operations</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div id="operator-dashboard" class="flow-card">
                        <div class="icon operator-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
                            </svg>
                        </div>
                        <h3>Operator Dashboard</h3>
                        <div class="subtitle">Business Hub</div>
                        <p class="content">Revenue analytics, booking overview, performance metrics. Track: login frequency, feature usage, revenue trends</p>
                    </div>

                    <div id="listings-management" class="flow-card">
                        <div class="icon operator-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                            </svg>
                        </div>
                        <h3>Listings Management</h3>
                        <div class="subtitle">Content</div>
                        <p class="content">Create/edit trips, pricing, availability calendar, photos. Track: listing completion rate, update frequency</p>
                    </div>

                    <div id="booking-management" class="flow-card">
                        <div class="icon operator-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
                            </svg>
                        </div>
                        <h3>Booking Management</h3>
                        <div class="subtitle">Operations</div>
                        <p class="content">Accept/decline bookings, guest communication, calendar management. Track: response time, acceptance rate</p>
                    </div>

                    <div id="financial-reports" class="flow-card">
                        <div class="icon operator-flow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                            </svg>
                        </div>
                        <h3>Financial Reports</h3>
                        <div class="subtitle">Analytics</div>
                        <p class="content">Revenue tracking, payout management, tax reporting. Track: revenue per listing, seasonal trends</p>
                    </div>
                </div>
            </div>

            <!-- ERROR HANDLING & EDGE CASES -->
            <div class="mb-16">
                <div class="section-header">
                    <h2 class="text-2xl font-bold text-red-700">ERROR HANDLING & EDGE CASES</h2>
                    <p class="text-sm text-gray-600 mt-1">System resilience and user experience optimization</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div id="payment-failed" class="flow-card error-state">
                        <div class="icon error-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                            </svg>
                        </div>
                        <h3>Payment Failed</h3>
                        <div class="subtitle">Recovery Flow</div>
                        <p class="content">Retry payment, alternative methods, save booking draft. Track: failure reasons, recovery success rate</p>
                    </div>

                    <div id="booking-conflict" class="flow-card error-state">
                        <div class="icon error-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                            </svg>
                        </div>
                        <h3>Booking Conflicts</h3>
                        <div class="subtitle">Resolution</div>
                        <p class="content">Date unavailable, suggest alternatives, waitlist options. Track: conflict frequency, resolution rate</p>
                    </div>

                    <div id="operator-rejection" class="flow-card error-state">
                        <div class="icon error-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728" />
                            </svg>
                        </div>
                        <h3>Operator Decline</h3>
                        <div class="subtitle">Guest Service</div>
                        <p class="content">Booking declined, refund process, alternative suggestions. Track: decline rate, refund processing time</p>
                    </div>

                    <div id="system-errors" class="flow-card error-state">
                        <div class="icon error-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                            </svg>
                        </div>
                        <h3>System Errors</h3>
                        <div class="subtitle">Maintenance</div>
                        <p class="content">Server errors, maintenance mode, data sync issues. Track: error frequency, downtime impact, user notifications</p>
                    </div>
                </div>
            </div>
            
            <!-- SVG for Arrows -->
            <svg id="arrow-svg" class="absolute top-0 left-0 w-full h-full overflow-visible" style="pointer-events: none; z-index: 10;">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
                    </marker>
                    <marker id="conversion-arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b" />
                    </marker>
                    <marker id="error-arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444" />
                    </marker>
                </defs>
            </svg>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('sitemap-container');
            const svg = document.getElementById('arrow-svg');

            function createSimpleArrow(fromId, toId, type = 'normal') {
                const fromEl = document.getElementById(fromId);
                const toEl = document.getElementById(toId);
                if (!fromEl || !toEl) return;

                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();

                const startX = fromRect.left + fromRect.width / 2 - containerRect.left;
                const startY = fromRect.bottom - containerRect.top + 10;
                const endX = toRect.left + toRect.width / 2 - containerRect.left;
                const endY = toRect.top - containerRect.top - 10;

                // Only draw if elements are reasonably positioned
                if (startY < endY - 20) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    
                    if (type === 'conversion') {
                        line.setAttribute('stroke', '#f59e0b');
                        line.setAttribute('stroke-width', '3');
                        line.setAttribute('marker-end', 'url(#conversion-arrowhead)');
                    } else if (type === 'error') {
                        line.setAttribute('stroke', '#ef4444');
                        line.setAttribute('stroke-width', '2');
                        line.setAttribute('stroke-dasharray', '5,5');
                        line.setAttribute('marker-end', 'url(#error-arrowhead)');
                    } else {
                        line.setAttribute('stroke', '#64748b');
                        line.setAttribute('stroke-width', '2');
                        line.setAttribute('marker-end', 'url(#arrowhead)');
                    }
                    
                    svg.appendChild(line);
                }
            }

            function createHorizontalArrow(fromId, toId, type = 'normal') {
                const fromEl = document.getElementById(fromId);
                const toEl = document.getElementById(toId);
                if (!fromEl || !toEl) return;

                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();

                const startX = fromRect.right - containerRect.left + 10;
                const startY = fromRect.top + fromRect.height / 2 - containerRect.top;
                const endX = toRect.left - containerRect.left - 10;
                const endY = toRect.top + toRect.height / 2 - containerRect.top;
                
                // Only draw if elements are reasonably positioned
                if (startX < endX - 20) {
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midX = startX + (endX - startX) / 2;
                    const controlY = Math.min(startY, endY) - 30;
                    
                    const d = `M ${startX} ${startY} Q ${midX} ${controlY} ${endX} ${endY}`;
                    path.setAttribute('d', d);
                    path.setAttribute('fill', 'none');
                    
                    if (type === 'conversion') {
                        path.setAttribute('stroke', '#f59e0b');
                        path.setAttribute('stroke-width', '3');
                        path.setAttribute('marker-end', 'url(#conversion-arrowhead)');
                    } else if (type === 'error') {
                        path.setAttribute('stroke', '#ef4444');
                        path.setAttribute('stroke-width', '2');
                        path.setAttribute('stroke-dasharray', '5,5');
                        path.setAttribute('marker-end', 'url(#error-arrowhead)');
                    } else {
                        path.setAttribute('stroke', '#64748b');
                        path.setAttribute('stroke-width', '2');
                        path.setAttribute('marker-end', 'url(#arrowhead)');
                    }
                    
                    svg.appendChild(path);
                }
            }

            function drawAllConnections() {
                // Clear existing and setup markers
                svg.innerHTML = `
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
                        </marker>
                        <marker id="conversion-arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b" />
                        </marker>
                        <marker id="error-arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444" />
                        </marker>
                    </defs>
                `;
                
                // Main conversion funnel (horizontal flow)
                createHorizontalArrow('homepage', 'search-browse', 'conversion');
                createHorizontalArrow('search-browse', 'trip-detail', 'conversion');
                createHorizontalArrow('trip-detail', 'booking-flow', 'conversion');
                
                // Authentication flows (connections to auth from different entry points)
                createHorizontalArrow('homepage', 'auth-entry');
                createHorizontalArrow('search-browse', 'auth-entry');
                createHorizontalArrow('trip-detail', 'auth-entry');
                
                // Booking to payment system
                createHorizontalArrow('booking-flow', 'payment-system', 'conversion');
                createHorizontalArrow('payment-system', 'booking-confirmation', 'conversion');
                
                // Post-auth flows (vertical)
                createSimpleArrow('auth-entry', 'guest-dashboard');
                createSimpleArrow('auth-entry', 'operator-dashboard');
                
                // Operator flows (horizontal)
                createHorizontalArrow('operator-dashboard', 'listings-management');
                createHorizontalArrow('operator-dashboard', 'booking-management');
                createHorizontalArrow('operator-dashboard', 'financial-reports');
                
                // Key error flows
                createHorizontalArrow('payment-system', 'payment-failed', 'error');
                createHorizontalArrow('booking-flow', 'booking-conflict', 'error');
            }
            
            // Initial draw with delay to ensure DOM is ready
            setTimeout(drawAllConnections, 500);
            
            // Redraw on resize with debouncing
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(drawAllConnections, 300);
            });
        });
    </script>
</body>
</html>
